# 关于x86裸金属MBR程序

## 过程

* 学习示例代码，学习一些常用的x86指令
* 学习linux下nasm的使用
* 了解内存映射以及8254计数器的工作原理
* 编写相应的x86代码，实现要求的功能

## 遇到的问题及解决方法

* 不了解8254计时器的功能，网上的资料也很少。后来通过询问助教了解到其对应的0x046c中的值每秒约改变18次，且为递增，故可使用比较和分支跳转来完成每秒输出的功能
* 刚开始不了解sti的含义，后来明白开启中断是为了可以让计数器中断程序来改变0x046c中的值，故要把sti放在开头，使整个程序运行过程中都可以响应中断
* 刚开始不了解lodsb的机制，导致一次输出之后后续没有输出或者输出乱码，后来了解到lodsb会使指针自增，故在下次输出前要将指针复位，来避免输出乱码和没有输出
* 在网上查询资料，通过改变显卡的显示模式以及使用设置显示模式的10h中断，实现清屏功能。通过调用21h中断，在dl中放入输出的字符（0DH即为换行符），在ah中放入2实现显示输出的功能。

## 建议及感悟

* 网上关于x86指令的信息非常繁杂，需要找到可靠性高的官方文档了解相应指令的功能
* 给出的参考手册里一些指令不能在nasm上运行，格式稍有差别